<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beer Translate & Games Ultimate</title>
    <style>
        /* --- –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò --- */
        body { background-color: #121316; color: #e8eaed; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; overflow: hidden; user-select: none; -webkit-user-select: none; touch-action: none; }
        .title-container { margin-bottom: 20px; display: flex; align-items: baseline; gap: 10px; cursor: grab; z-index: 20; }
        h1 { font-weight: 400; font-size: 32px; color: #bdc1c6; margin: 0; pointer-events: none; }
        .author-tag { font-size: 14px; color: #5f6368; font-weight: 500; opacity: 0.7; pointer-events: none; }

        .translator-container { background-color: #1e1f21; border: 1px solid #3c4043; border-radius: 12px; width: 95%; max-width: 1100px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; z-index: 10; }
        .header-tabs { display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid #3c4043; height: 55px; flex-shrink: 0; }
        .tab { color: #8ab4f8; font-size: 14px; font-weight: 500; border-bottom: 2px solid #8ab4f8; height: 100%; display: flex; align-items: center; padding: 0 10px; cursor: pointer; }
        .tab.inactive { border-bottom: 2px solid transparent; color: #9aa0a6; }
        .swap-icon { margin: 0 15px; color: #9aa0a6; cursor: pointer; font-size: 24px; }
        .right-tabs { margin-left: auto; display: flex; gap: 5px; }
        .action-tab { color: #8ab4f8; font-size: 13px; text-transform: uppercase; font-weight: bold; cursor: pointer; padding: 8px 10px; border-radius: 4px; }

        .main-panels { display: flex; flex-wrap: wrap; height: 100%; }
        .panel { flex: 1; min-width: 300px; min-height: 250px; padding: 20px; position: relative; display: flex; flex-direction: column; background: #1e1f21; box-sizing: border-box; }
        .input-panel { border-right: 1px solid #3c4043; }
        textarea { width: 100%; height: 100%; background: transparent; border: none; color: #fff; font-size: 20px; resize: none; outline: none; font-family: inherit; }
        #output-field { font-size: 20px; color: #bdc1c6; word-break: break-all; white-space: pre-wrap; flex-grow: 1; }

        /* –ò–ì–†–û–í–û–ï –û–ö–ù–û */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 5000; justify-content: center; align-items: center; }
        .game-window { background: #1e1f21; border: 1px solid #3c4043; border-radius: 12px; width: 800px; max-width: 95%; height: 600px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .game-header { padding: 15px; border-bottom: 1px solid #3c4043; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .game-menu { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .game-btn { background: #303134; color: #e8eaed; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .game-btn:hover { background: #8ab4f8; color: #000; }
        .close-game { cursor: pointer; color: #9aa0a6; font-size: 24px; }
        .game-content { padding: 20px; display: none; flex-direction: column; align-items: center; height: 100%; overflow: hidden; }
        .back-btn { margin-bottom: 15px; align-self: flex-start; background: none; border: none; color: #9aa0a6; cursor: pointer; font-size: 16px; }

        /* –ß–ê–¢ (–§–û–†–£–ú) –°–¢–ò–õ–ò */
        #forumContainer { display: none; flex-direction: column; height: 100%; }
        .forum-posts { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; max-height: 400px; scroll-behavior: smooth; }
        .post-card { background: #303134; padding: 10px; border-radius: 8px; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); width: fit-content; max-width: 90%; }
        .post-author { color: #8ab4f8; font-weight: bold; font-size: 12px; margin-bottom: 4px; }
        .post-text { color: #e8eaed; word-wrap: break-word; }
        .post-img { max-width: 100%; border-radius: 8px; margin-top: 5px; display: block; }
        .forum-input-area { padding: 15px; background: #202124; border-top: 1px solid #3c4043; display: flex; gap: 10px; flex-shrink: 0; }
        .forum-input-area input { background: #303134; border: 1px solid #5f6368; color: #fff; padding: 10px; border-radius: 4px; width: 100px; outline: none; }
        .forum-input-area textarea { flex: 1; height: 40px; padding: 10px; border: 1px solid #5f6368; border-radius: 4px; background: #303134; color: #fff; font-size: 14px; resize: none; outline: none; font-family: inherit; }
        .forum-btn { background: #8ab4f8; border: none; padding: 0 20px; border-radius: 4px; font-weight: bold; cursor: pointer; color: #000; }
    </style>
</head>
<body>

    <div class="title-container">
        <h1>Beer Translate & Games</h1>
        <span class="author-tag">Ultimate Edition</span>
    </div>

    <div class="translator-container">
        <div class="header-tabs">
            <div class="tab" id="left-label">–¢–µ–∫—Å—Ç</div>
            <div class="swap-icon" onclick="toggleMode()">‚áÑ</div>
            <div class="tab inactive" id="right-label">–ü–∏–≤–Ω–æ–π —è–∑—ã–∫</div>
            <div class="right-tabs">
                <div class="action-tab" onclick="openGameModal()">–ú–µ–Ω—é / –ò–≥—Ä—ã</div>
            </div>
        </div>
        <div class="main-panels">
            <div class="panel input-panel">
                <textarea id="input-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..." oninput="doTranslate()"></textarea>
            </div>
            <div class="panel">
                <div id="output-field"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="gameModal">
        <div class="game-window">
            <div class="game-header">
                <span id="gameTitle" style="font-weight:bold; color:#bdc1c6">–ú–µ–Ω—é</span>
                <div class="close-game" onclick="closeGameModal()">‚úï</div>
            </div>
            
            <div class="game-menu" id="gameMenu">
                <button class="game-btn" onclick="initForum()">üí¨ –ñ–ò–í–û–ô –ß–ê–¢</button>
                <button class="game-btn" onclick="alert('–°–∫–æ—Ä–æ...')">üéÆ –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã</button>
            </div>

            <div id="forumContainer">
                <div style="padding: 10px 15px; border-bottom: 1px solid #3c4043; display: flex; align-items: center; justify-content: space-between;">
                    <button class="back-btn" onclick="backToMenu()">‚Üê –ù–∞–∑–∞–¥</button>
                    <span style="font-size:12px; color:#5f6368">9 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ñ–æ–∫—É—Å–µ, –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å–∫—Ä–æ–ª–ª</span>
                </div>
                <div class="forum-posts" id="forumPosts"></div>
                <div class="forum-input-area">
                    <input id="forumName" placeholder="–ò–º—è" maxlength="15" value="–ê–Ω–æ–Ω–∏–º">
                    <textarea id="forumText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ GIF (Enter - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å)" maxlength="500"></textarea>
                    <button class="forum-btn" onclick="sendPost()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        /* ====== –ü–ï–†–ï–í–û–î–ß–ò–ö ====== */
        const beerMap = {'–ê': '–≤–ª–¥–∞–æ–ª–¥—Ü—Ç3894', '–ë': '78–µ–º9—Ç4325243895—Ç–º72', '–í': '–∞—Ç–¥–ª–∂–∏—ã—Ñ–≤–µ–∏0653'}; // –£–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
        let isBeerToText = false;
        function toggleMode() { isBeerToText = !isBeerToText; document.getElementById('left-label').innerText = isBeerToText ? '–ü–∏–≤–Ω–æ–π —è–∑—ã–∫' : '–¢–µ–∫—Å—Ç'; }
        function doTranslate() {
            const val = document.getElementById('input-text').value.toUpperCase();
            document.getElementById('output-field').innerText = val.split('').map(char => beerMap[char] || char).join('');
        }

        /* ====== –°–ò–°–¢–ï–ú–ê –û–ö–û–ù ====== */
        const modal = document.getElementById('gameModal');
        const menu = document.getElementById('gameMenu');
        const forum = document.getElementById('forumContainer');

        function openGameModal() { modal.style.display = 'flex'; backToMenu(); }
        function closeGameModal() { modal.style.display = 'none'; }
        function backToMenu() { menu.style.display = 'grid'; forum.style.display = 'none'; document.getElementById('gameTitle').innerText = '–ú–µ–Ω—é'; }
        function initForum() { menu.style.display = 'none'; forum.style.display = 'flex'; document.getElementById('gameTitle').innerText = '–ß–∞—Ç'; }

        /* ====== FIREBASE –õ–û–ì–ò–ö–ê ====== */
        const firebaseConfig = {
            apiKey: "AIzaSyCesMs7AFeefzwVLhJfKyA3_QROoRnnONo",
            authDomain: "beerlanguage-1337.firebaseapp.com",
            projectId: "beerlanguage-1337",
            storageBucket: "beerlanguage-1337.firebasestorage.app",
            messagingSenderId: "18636363390",
            appId: "1:18636363390:web:aa02dfd1ce7e53f6d0aa2f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
        function isImg(url) { return /\.(jpg|jpeg|png|webp|gif)$/.test(url.toLowerCase()) || url.includes("giphy.com"); }

        // –û—Ç–ø—Ä–∞–≤–∫–∞
        async function sendPost() {
            const name = document.getElementById('forumName').value.trim();
            const text = document.getElementById('forumText').value.trim();
            if(!text) return;

            try {
                await db.collection("posts").add({ name, text, time: Date.now() });
                document.getElementById('forumText').value = "";
            } catch(e) { console.error(e); }
        }

        // –°–ª—É—à–∞—Ç–µ–ª—å Enter
        document.getElementById('forumText').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendPost();
            }
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
        db.collection("posts").orderBy("time", "asc").onSnapshot(snap => {
            const cont = document.getElementById('forumPosts');
            cont.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                const card = document.createElement('div');
                card.className = "post-card";
                
                let content = isImg(p.text) 
                    ? `<img src="${p.text}" class="post-img">` 
                    : `<div class="post-text">${escapeHtml(p.text)}</div>`;
                
                card.innerHTML = `<div class="post-author">${escapeHtml(p.name)}</div>${content}`;
                cont.appendChild(card);
            });
            cont.scrollTop = cont.scrollHeight; // –í—Å–µ–≥–¥–∞ –≤ –∫–æ–Ω–µ—Ü
        });

        function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
    </script>
</body>
</html>
